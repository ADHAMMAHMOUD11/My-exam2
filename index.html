<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ุงูุชุญุงู ุฃุญูุงุก โ ุฏุฎูู ูุฑุฉ ูุงุญุฏุฉ</title>
<style>
  :root{
    --bg:#fbfdff;
    --card:#ffffff;
    --primary:#0b63d6; /* ุฃุฒุฑู ุฑุณูู */
    --accent:#d32f2f;  /* ุฃุญูุฑ ูุดุฑูุท ุงูุนุฏูุงุฏ */
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Tajawal","Cairo",Tahoma,Arial,sans-serif;
    background:linear-gradient(180deg,#f3f8ff,#ffffff); color:#071534; direction:rtl;
  }
  /* ุดุฑูุท ุงูุนุฏูุงุฏ ุงูุนููู */
  .topbar{
    height:12px; background:linear-gradient(90deg,var(--accent), #ff8a80);
    position:relative;
    overflow:hidden;
  }
  .progress{
    position:absolute; left:0; top:0; bottom:0; width:100%;
    background:linear-gradient(90deg,var(--accent), #ff8a80);
  }
  .wrap{max-width:980px;margin:18px auto;padding:18px}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 12px 30px rgba(7,21,52,0.06)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{margin:0;color:var(--primary);font-size:20px}
  .timerBox{display:flex;align-items:center;gap:12px}
  .timer{
    padding:8px 12px;border-radius:10px;background:rgba(11,99,214,0.08);
    color:var(--primary);font-weight:700;
  }
  .grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
  .left{padding-right:6px}
  .question{margin-bottom:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border-right:5px solid var(--primary);box-shadow:0 6px 14px rgba(11,63,128,0.03)}
  .question p{margin:0 0 8px;font-weight:700;color:#123}
  label.option{display:block;margin:6px 0;padding:8px;border-radius:8px;cursor:pointer;border:1px solid transparent;transition:all .12s}
  label.option:hover{transform:translateY(-2px);border-color:rgba(11,63,128,0.06)}
  input[type="radio"]{margin-left:8px;transform:scale(1.05)}
  .panel{position:sticky;top:20px;padding:14px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfbff);box-shadow:0 8px 18px rgba(11,63,128,0.05)}
  .panel h3{margin:0 0 8px;color:var(--primary)}
  .field{margin-bottom:10px}
  .field label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  .field input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9}
  .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:8px}
  button.primary{background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:9px;cursor:pointer;font-weight:700}
  button.danger{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:9px;cursor:pointer;font-weight:700}
  .locked{padding:18px;text-align:center;color:var(--accent);font-weight:700}
  footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
  .metaSmall{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
  @media(max-width:880px){ .grid{grid-template-columns:1fr} .panel{position:static;margin-top:12px} }
</style>
</head>
<body>
  <!-- ุดุฑูุท ุงูุนุฏูุงุฏ ุงููุฑุฆู (ูุชุญุฑู ุจุงูู JS) -->
  <div class="topbar" aria-hidden="true">
    <div id="progressBar" class="progress" style="width:100%"></div>
  </div>

  <div class="wrap">
    <div class="card">
      <header>
        <h1>ุงูุชุญุงู ุฃุญูุงุก โ ุฏุฎูู ูุฑุฉ ูุงุญุฏุฉ</h1>
        <div class="timerBox">
          <div class="timer" aria-live="polite">โฑ ุงูููุช ุงููุชุจูู: <span id="time">25:00</span></div>
        </div>
      </header>

      <div class="grid">
        <div class="left">
          <div id="quizArea" role="region" aria-label="ููุทูุฉ ุงูุงูุชุญุงู">
            <form id="quizForm">
              <!-- ุงูุฃุณุฆูุฉ 1..15 (ูุทุงุจูุฉ ููู ุงูุช ุนููุช ุนููู) -->
              <div class="question" id="q1">
                <p>1. ุฃู ุงูุจุฏุงุฆู ุงูุขุชูุฉ ูุง ููุนุชุจุฑ ูู ููููุงุช ุงููููู ุงูุนุธููุ</p>
                <label class="option"><input type="radio" name="q1" value="a"> ููุญ ุงููุชู</label>
                <label class="option"><input type="radio" name="q1" value="b"> ุงูููุตู</label>
                <label class="option"><input type="radio" name="q1" value="c"> ุงูุฃุฑุจุทุฉ</label>
                <label class="option"><input type="radio" name="q1" value="d"> ููุทูุฉ ุงูุญูุถ</label>
              </div>

              <div class="question" id="q2">
                <p>2. ุงููุณุจุฉ ุจูู ุทูู ุงูุถูุน ุฑูู (6) ุฅูู ุทูู ุงูุถูุน ุฑูู (1):</p>
                <label class="option"><input type="radio" name="q2" value="a"> ุฃูุจุฑ ูู ูุงุญุฏ</label>
                <label class="option"><input type="radio" name="q2" value="b"> ุฃูู ูู ูุงุญุฏ</label>
                <label class="option"><input type="radio" name="q2" value="c"> ูุณุงูู ูุงุญุฏ</label>
                <label class="option"><input type="radio" name="q2" value="d"> ูุง ูููู ุชุญุฏูุฏู</label>
              </div>

              <div class="question" id="q3">
                <p>3. ุงููุณุจุฉ ุจูู ุนุฏุฏ ุนุธุงู ุงูุญุฒุงู ุงูุญูุถู ุฅูู ุนุธุงู ุงูุญุฒุงู ุงูุตุฏุฑู ููุณุจุฉ:</p>
                <label class="option"><input type="radio" name="q3" value="a">(1 ุฅูู 2)</label>
                <label class="option"><input type="radio" name="q3" value="b">(1 ุฅูู 1)</label>
                <label class="option"><input type="radio" name="q3" value="c">(3 ุฅูู 2)</label>
                <label class="option"><input type="radio" name="q3" value="d">(2 ุฅูู 1)</label>
              </div>

              <div class="question" id="q4">
                <p>4. ุฃูุจุฑ ุชุฌุงููู ุงููููู ุงูุทุฑูู ุนูููุง:</p>
                <label class="option"><input type="radio" name="q4" value="a"> ุชุฌููู ุงูุฒูุฏ</label>
                <label class="option"><input type="radio" name="q4" value="b"> ุงูุชุฌููู ุงูุญููููู</label>
                <label class="option"><input type="radio" name="q4" value="c"> ุงูุชุฌููู ุงูุฃุฑูุญ</label>
                <label class="option"><input type="radio" name="q4" value="d"> ูููู ููุตู ูุญุฏูุฏ ุงูุญุฑูุฉ</label>
              </div>

              <div class="question" id="q5">
                <p>5. ุชูุฏู ุญุฑูุฉ ุงูุฌุฐูุฑ ุงูุดุงุฏูุฉ ุฅูู:</p>
                <label class="option"><input type="radio" name="q5" value="a"> ุชุฃููู ุณุงู ุงููุจุงุช ูุงูุฃูุฑุงู</label>
                <label class="option"><input type="radio" name="q5" value="b"> ุฒูุงุฏุฉ ุทูู ุงูุฌุฐูุฑ ุงูุดุงุฏูุฉ</label>
                <label class="option"><input type="radio" name="q5" value="c"> ุฒูุงุฏุฉ ุงููุฏุฑุฉ ุนูู ุงูุชุตุงุต ุงููุงุก</label>
                <label class="option"><input type="radio" name="q5" value="d"> ุฒูุงุฏุฉ ูุฏุฑุฉ ุงููุจุงุช ุนูู ุงูููุงู ุจุนูููุฉ ุงูุจูุงุก ุงูุถูุฆู</label>
              </div>

              <div class="question" id="q6">
                <p>6. ุฃู ุงููุคุซุฑุงุช ุงูุชุงููุฉ ุชุฒูุฏ ูู ุณุฑุนุฉ ุชุจุงุนุฏ ูุฑููุงุช ุงููุณุชุญูุฉุ</p>
                <label class="option"><input type="radio" name="q6" value="a"> ุณููุท ุงูุฃูุทุงุฑ</label>
                <label class="option"><input type="radio" name="q6" value="b"> ุงูุธูุงู</label>
                <label class="option"><input type="radio" name="q6" value="c"> ุงูุถูุก</label>
              </div>

              <div class="question" id="q7">
                <p>7. ูููู ุงูุงุณุชุฏูุงู ุนูู ุญุฏูุซ ุงูุงูุณูุงุจ ุงูุณูุชูุจูุงุฒูู ุจุญุฑูุฉ:</p>
                <label class="option"><input type="radio" name="q7" value="a"> ุนุถููุงุช ุชุชุตู ุจุชุนุฏุฏ ุฃููุงููุง</label>
                <label class="option"><input type="radio" name="q7" value="b"> ุนุถูุงุช ุนุฏููุฉ ุงูููู</label>
                <label class="option"><input type="radio" name="q7" value="c"> ุงูุฌุฏุงุฑ ุงูุฎููู</label>
                <label class="option"><input type="radio" name="q7" value="d"> ุงูุบุดุงุก ุงูุฎููู</label>
              </div>

              <div class="question" id="q8">
                <p>8. ุชุชููู ุงูุนุถูุงุช ูู ุฃูุณุฌุฉ ุนุถููุฉ ุชุนุฑู ุจู:</p>
                <label class="option"><input type="radio" name="q8" value="a"> ุงููุญู</label>
                <label class="option"><input type="radio" name="q8" value="b"> ุงูุฎูุงูุง ุงูุนุถููุฉ</label>
                <label class="option"><input type="radio" name="q8" value="c"> ุงูููููุงุช ุงูุนุถููุฉ</label>
                <label class="option"><input type="radio" name="q8" value="d"> ุงููุทุน ุงูุนุถููุฉ</label>
              </div>

              <div class="question" id="q9">
                <p>9. ุงูุฃูููุงุช ุงูุชู ูุฑุชุจุท ูุนุฏู ูุฑูุฑูุง ุฎูุงู ุบุดุงุก ุงููููุฉ ุงูุนุถููุฉ ุจุฅุซุงุฑุฉ ุงูุนุถูุฉ:</p>
                <label class="option"><input type="radio" name="q9" value="a"> ุงูุตูุฏููู</label>
                <label class="option"><input type="radio" name="q9" value="b"> ุงููุงูุณููู ูุงูุตูุฏููู</label>
                <label class="option"><input type="radio" name="q9" value="c"> ุงููููุฑ ูุงูุจุฑูุชูู</label>
                <label class="option"><input type="radio" name="q9" value="d"> ุงููุงูุณููู ูุงูุจูุชุงุณููู</label>
              </div>

              <div class="question" id="q10">
                <p>10. ุชููู ุฎูุงูุง ุงูุนุถูุงุช ุงูุชู ุชููู ุจูุดุงุท ุนููู ูุณุจุฉ ุนุงููุฉ ูู:</p>
                <label class="option"><input type="radio" name="q10" value="a"> ุญูุถ ุงููุงูุชูู</label>
                <label class="option"><input type="radio" name="q10" value="b"> ุญูุถ ุงูุจูุฑูููู</label>
                <label class="option"><input type="radio" name="q10" value="c"> ุญูุถ ุงูุณุชุฑูู</label>
                <label class="option"><input type="radio" name="q10" value="d"> ุญูุถ ุงูุฃุณูุชูู</label>
              </div>

              <div class="question" id="q11">
                <p>11. ูู ุฃุณุจุงุจ ุงูุฅุฌูุงุฏ ุงูุณุฑูุน ูุนุถูุฉ ุงููุฎุฐ:</p>
                <label class="option"><input type="radio" name="q11" value="a"> ุฒูุงุฏุฉ ูุณุจุฉ ุงูุฌููููุฌูู ุจุงูุนุถูุฉ</label>
                <label class="option"><input type="radio" name="q11" value="b"> ุถูู ุงูุดุฑุงููู ุงููุบุฐูุฉ ููุนุถูุฉ</label>
                <label class="option"><input type="radio" name="q11" value="c"> ุฒูุงุฏุฉ ุงูุฃูุณุฌูู ุงููุงุฑุฏ ููุนุถูุฉ</label>
                <label class="option"><input type="radio" name="q11" value="d"> ููุต ุซุงูู ุฃูุณูุฏ ุงููุฑุจูู ุจุงูุนุถูุฉ</label>
              </div>

              <div class="question" id="q12">
                <p>12. ุงููุณุจุฉ ุจูู ุญุฌู ุนุธูุฉ ุงูููุนุฑุฉ ุฅูู ุญุฌู ุนุธูุฉ ุงูุฒูุฏ:</p>
                <label class="option"><input type="radio" name="q12" value="a"> ุชุณุงูู ูุงุญุฏ</label>
                <label class="option"><input type="radio" name="q12" value="b"> ุฃูู ูู ูุงุญุฏ</label>
                <label class="option"><input type="radio" name="q12" value="c"> ุฃูุจุฑ ูู ูุงุญุฏ</label>
                <label class="option"><input type="radio" name="q12" value="d"> ูุง ูููู ุชุญุฏูุฏู</label>
              </div>

              <div class="question" id="q13">
                <p>13. ุงูุญููุฉ ุงูุดูููุฉ ูู ุญููุฉ ุนุธููุฉ ุชุชุตู ุจุงูุฌุฒุก ุงูุฎุงุต ุจู:</p>
                <label class="option"><input type="radio" name="q13" value="a"> ุงูุถูุน ุฑูู (2)</label>
                <label class="option"><input type="radio" name="q13" value="b"> ุงููุชูุก ุงูุดููู</label>
                <label class="option"><input type="radio" name="q13" value="c"> ุนุธูุฉ ุงููุต</label>
                <label class="option"><input type="radio" name="q13" value="d"> ุฌุณู ุงูููุฑุฉ ุงููุทููุฉ</label>
              </div>

              <div class="question" id="q14">
                <p>14. ุชุชุบุฐู ุงูุบุถุงุฑูู ุนู ุทุฑูู:</p>
                <label class="option"><input type="radio" name="q14" value="a"> ุฃูุนูุฉ ุฏูููุฉ ุดุฑูุงููุฉ</label>
                <label class="option"><input type="radio" name="q14" value="b"> ุฃูุนูุฉ ุฏูููุฉ ูุฑูุฏูุฉ</label>
                <label class="option"><input type="radio" name="q14" value="c"> ุงูุงูุชุดุงุฑ ูู ุงูุนุธุงู</label>
                <label class="option"><input type="radio" name="q14" value="d"> ุงูุงุณููุฒูุฉ ูู ุงูุนุธุงู</label>
              </div>

              <div class="question" id="q15">
                <p>15. ุฃุตุบุฑ ูุญุฏุฉ ุชุฎุฒูู ูู:</p>
                <label class="option"><input type="radio" name="q15" value="a"> ุงูุฃูุฑุงุต ุงูุจุฑูุชูููุฉ</label>
                <label class="option"><input type="radio" name="q15" value="b"> ุงููููุฉ ุงูุนุถููุฉ</label>
                <label class="option"><input type="radio" name="q15" value="c"> ุงููุทุนุฉ ุงูุนุถููุฉ</label>
              </div>

            </form>
          </div>
        </div>

        <aside>
          <div class="panel" role="complementary">
            <h3>ุชูุงุตูู ูุชุณููู ุงูุงูุชุญุงู</h3>
            <div class="field">
              <label for="studentName">ุงุณู ุงูุทุงูุจ (ูุทููุจ)</label>
              <input id="studentName" type="text" placeholder="ุงูุชุจ ุงุณูู ุงููุงูู" autocomplete="name" />
            </div>

            <div class="field">
              <div class="metaSmall">ุงูุงูุชุญุงู ููุชุญ ูุฑุฉ ูุงุญุฏุฉ ููุท ูู ูุฐุง ุงููุชุตูุญ. ุงูุฎุฑูุฌ/ุงูุชุญุฏูุซ ููุญุชุณุจ ูุชุณููู ุชููุงุฆู.</div>
            </div>

            <div class="actions">
              <button class="primary" id="submitBtn">ุชุณููู ุงูุงูุชุญุงู</button>
              <button class="danger" id="forceSubmitBtn" title="ุชุณููู ุงูุขู (ุฅุฌุจุงุฑ)">ุชุณููู ููุฑู</button>
            </div>

            <div style="margin-top:10px;font-size:13px;color:var(--muted)">
              ุนูุฏ ุงูุชุณููู ุณููุชุญ ูุงุชุณุงุจ ุฅูู: <strong>+201102323525</strong> ูุน ุฑุณุงูุฉ ุงููุชูุฌุฉ ุฌุงูุฒุฉ ููุฅุฑุณุงู.
            </div>
          </div>
        </aside>
      </div>

      <div id="locked" class="card" style="display:none;margin-top:12px">
        <div class="locked">โ๏ธ ูุฐุง ุงูุงูุชุญุงู ูุบูู โ ููุฏ ุชู ุงูุชูุฏูู ุจุงููุนู ูู ูุฐุง ุงููุชุตูุญ.</div>
        <div style="text-align:center;margin-top:8px;color:var(--muted)">ุชู ุงูุชุณููู ุจุชุงุฑูุฎ: <span id="takenAt"></span></div>
        <div style="text-align:center;margin-top:6px;color:var(--muted)">ุงููุฏุฉ ุงููุณุชุบุฑูุฉ: <span id="duration"></span></div>
      </div>

      <footer>ยฉ ุฌููุน ุงูุญููู ูุญููุธุฉ ู ูู ูุงุทูุฉ 2025</footer>
    </div>
  </div>

<script>
(function(){
  const WA_NUMBER = "+201102323525";
  const STORAGE_KEY = "exam_one_time_electronic_v1";
  const TOTAL_SECONDS = 25 * 60; // 25 ุฏูููุฉ
  const correctAnswers = {
    q1:"d", q2:"a", q3:"a", q4:"b", q5:"a",
    q6:"c", q7:"a", q8:"a", q9:"a", q10:"a",
    q11:"b", q12:"b", q13:"d", q14:"c", q15:"c"
  };

  // DOM
  const form = document.getElementById("quizForm");
  const submitBtn = document.getElementById("submitBtn");
  const forceSubmitBtn = document.getElementById("forceSubmitBtn");
  const nameInput = document.getElementById("studentName");
  const timeSpan = document.getElementById("time");
  const progressBar = document.getElementById("progressBar");
  const lockedCard = document.getElementById("locked");
  const takenAtSpan = document.getElementById("takenAt");
  const durationSpan = document.getElementById("duration");

  // ููุน ุฅุนุงุฏุฉ ุงูุฏุฎูู ุฅู ุชู ุชุณููู ุณุงุจูุงู
  const prev = localStorage.getItem(STORAGE_KEY);
  if (prev) {
    form.style.display = "none";
    lockedCard.style.display = "block";
    try {
      const p = JSON.parse(prev);
      takenAtSpan.textContent = new Date(p.takenAt).toLocaleString("ar-EG");
      durationSpan.textContent = formatDuration(p.durationSeconds || 0);
      timeSpan.textContent = "00:00";
      updateProgress(0);
    } catch(e){
      takenAtSpan.textContent = "ุชู ุณุงุจููุง";
    }
    return;
  }

  // ุนุฏุงุฏ
  let remaining = TOTAL_SECONDS;
  const startTime = Date.now();
  let timer = setInterval(() => {
    remaining--;
    if (remaining < 0) remaining = 0;
    const m = Math.floor(remaining/60).toString().padStart(2,"0");
    const s = (remaining%60).toString().padStart(2,"0");
    timeSpan.textContent = `${m}:${s}`;
    // ุชุญุฏูุซ ุดุฑูุท ุงูุชูุฏูู (ูุณุจุฉ ูุชุจููุฉ)
    updateProgress(remaining / TOTAL_SECONDS);
    if (remaining === 0) {
      finalizeExam("ุงูุชูู ุงูููุช", false);
    }
  }, 1000);

  function updateProgress(fraction){
    // fraction: 0..1 (1 ูุนูู ูุงูู ูุชุจูู). ูุฑูุฏ ุนุฑุถ ูุง ุชุจูู => width%
    const percent = Math.max(0, Math.min(1, fraction)) * 100;
    progressBar.style.width = percent + "%";
  }

  // ููุน ุจุนุถ ุงูุงุฎุชุตุงุฑุงุช ูุฅุนุงุฏุฉ ุงูุชุญููู ูุงุนุชุจุงุฑูุง ุชุณููู
  document.addEventListener("keydown", function(e){
    if (e.key === "F5" || (e.ctrlKey && e.key.toLowerCase() === "r")) {
      e.preventDefault();
      finalizeExam("ูุญุงููุฉ ุชุญุฏูุซ/ุฅุนุงุฏุฉ ุชุญููู", false);
    }
  });
  document.addEventListener("contextmenu", e => e.preventDefault());

  function collectAnswers(){
    const data = {};
    for (let i=1;i<=15;i++){
      const q = "q"+i;
      const sel = document.querySelector(`input[name="${q}"]:checked`);
      data[q] = sel ? sel.value : "ูู ูุฌุจ";
    }
    return data;
  }

  function grade(data){
    let correct = 0;
    for (let i=1;i<=15;i++){
      const q = "q"+i;
      if (data[q] && data[q] === correctAnswers[q]) correct++;
    }
    return {correct, total:15, percent: Math.round((correct/15)*100)};
  }

  function formatDuration(sec){
    const m = Math.floor(sec/60);
    const s = sec % 60;
    return `${m} ุฏูููุฉ ู ${s} ุซุงููุฉ`;
  }

  function finalizeExam(reason, triggeredBySubmit){
    if (localStorage.getItem(STORAGE_KEY)) return;
    clearInterval(timer);

    const studentName = (nameInput.value || "").trim();
    const responses = collectAnswers();
    const scoring = grade(responses);

    const takenAt = new Date();
    const durationSeconds = Math.max(0, Math.round((takenAt.getTime() - startTime)/1000));

    const payload = {
      takenAt: takenAt.toISOString(),
      reason: reason || "submitted",
      name: studentName,
      score: scoring,
      responses: responses,
      durationSeconds: durationSeconds
    };

    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    } catch(e){
      console.warn("localStorage error", e);
    }

    // ุงููุงู ุงูููุฑู ูุงุนูุงู ุงูููู
    form.style.display = "none";
    lockedCard.style.display = "block";
    takenAtSpan.textContent = takenAt.toLocaleString("ar-EG");
    durationSpan.textContent = formatDuration(durationSeconds);
    timeSpan.textContent = "00:00";
    updateProgress(0);

    // ุชุฌููุฒ ุฑุณุงูุฉ ูุงุชุณุงุจ
    let answersText = "";
    for (let i=1;i<=15;i++){
      answersText += `ุณ${i}: ${payload.responses["q"+i]} \n`;
    }
    const msg =
`๐ ูุชูุฌุฉ ุงูุชุญุงู โ ุงุณู ุงูุทุงูุจ: ${studentName || "ุบูุฑ ููุณุฌููู"}
โ ุงููุชูุฌุฉ: ${scoring.correct}/${scoring.total} โ (${scoring.percent}%)
๐ ููุช ุงูุงูุชูุงุก: ${takenAt.toLocaleString("ar-EG")}
โฑ ุงููุฏุฉ ุงููุณุชุบุฑูุฉ: ${formatDuration(durationSeconds)}
๐ฐ ุณุจุจ ุงูุชุณุฌูู: ${reason}
---
ุงูุฅุฌุงุจุงุช:
${answersText}
โ ููุงูุฉ ุงูุฑุณุงูุฉ.`;

    const encoded = encodeURIComponent(msg);
    const waUrl = `https://wa.me/${WA_NUMBER.replace(/^\+/, "")}?text=${encoded}`;

    // ูู ุฌุงุก ุจุณุจุจ ุฒุฑู (ุชูุงุนู ูุจุงุดุฑ) ููุชุญ ูุงุชุณุงุจ ููุถุบุท ุงูุทุงูุจ ุฅุฑุณุงู
    if (triggeredBySubmit) {
      try { window.open(waUrl, "_blank"); }
      catch(e){ console.warn("ูุชุญ ูุงุชุณุงุจ ูุดู:", e); }
    }

    // ูุนูู ุงูุทุงูุจ
    try {
      alert("ุชู ุชุณููู ุงูุงูุชุญุงู โ\nุงููุฏุฉ ุงููุณุชุบุฑูุฉ: " + formatDuration(durationSeconds) + "\n(ูู ููููู ุฅุนุงุฏุฉ ุงูุฏุฎูู ูู ููุณ ุงููุชุตูุญ)");
    } catch(e){}
  }

  // ุฒุฑ ุงูุชุณููู ุงููุฏูู: ููุชุญ ูุงุชุณุงุจ
  submitBtn.addEventListener("click", function(e){
    e.preventDefault();
    const name = (nameInput.value || "").trim();
    if (!name) { alert("ูู ูุถูู ุงูุชุจ ุงุณู ุงูุทุงูุจ ูุจู ุงูุชุณููู."); nameInput.focus(); return; }
    if (!confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณููู ุงูุงูุชุญุงูุ ุจุนุฏ ุงูุถุบุท ุณูุชู ุฅุบูุงู ุงูุงูุชุญุงู ููู ููููู ุฅุนุงุฏุฉ ุงูุฏุฎูู.")) return;
    finalizeExam("ุชุณููู ูุฏูู", true);
  });

  // ุฒุฑ ุชุณููู ููุฑู (ููุณ ูุธููุฉ ุงูุชุณููู ุงููุฏูู) โ ูุถุนุชู ููุซูุฉ
  forceSubmitBtn.addEventListener("click", function(e){
    e.preventDefault();
    const name = (nameInput.value || "").trim();
    if (!name) { alert("ูู ูุถูู ุงูุชุจ ุงุณู ุงูุทุงูุจ ูุจู ุงูุชุณููู."); nameInput.focus(); return; }
    finalizeExam("ุชุณููู ููุฑู", true);
  });

  // ุฒุฑ ูุนุงููุฉ (ุบูุฑ ูุณููู)
  document.getElementById("previewBtn").addEventListener("click", function(){
    alert("ุนุฑุถ ุงูุฃุณุฆูุฉ ููุท: ููููู ุงูุงุทูุงุน ูุงูุนูุฏุฉ. ููุชุณููู ุงุถุบุท \"ุชุณููู ุงูุงูุชุญุงู\".");
  });

  // ุนูุฏ ุงูุฎุฑูุฌ ูู ุงูุตูุญุฉ ุฃู ุชุบููุฑ ุงูุชุจููุจ ูุนุชุจุฑูุง ุชุณููููุง (ูุณุฌู ููุท)
  function handleLeave(){
    if (localStorage.getItem(STORAGE_KEY)) return;
    finalizeExam("ุงูุฎุฑูุฌ ูู ุงูุตูุญุฉ/ุฅุบูุงู", false);
  }
  window.addEventListener("pagehide", handleLeave);
  document.addEventListener("visibilitychange", function(){
    if (document.visibilityState === "hidden") handleLeave();
  });

  // ุชุญุฏูุซ ูู ุชุจููุจ ุขุฎุฑ
  window.addEventListener("storage", function(e){
    if (e.key === STORAGE_KEY && e.newValue) {
      form.style.display = "none";
      lockedCard.style.display = "block";
      try {
        const p = JSON.parse(e.newValue);
        takenAtSpan.textContent = new Date(p.takenAt).toLocaleString("ar-EG");
        durationSpan.textContent = formatDuration(p.durationSeconds || 0);
        timeSpan.textContent = "00:00";
        updateProgress(0);
      } catch(_) {}
    }
  });

})();
</script>
</body>
</html>
