<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>امتحان أحياء - دخول مرة واحدة</title>
<style>
  body{font-family:Tahoma, Arial, sans-serif;background:linear-gradient(135deg,#f6f9ff,#eef7f2);padding:20px;direction:rtl}
  .card{max-width:900px;margin:20px auto;background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  h1{text-align:center;color:#c62828;margin:0 0 12px}
  .timer{font-size:18px;color:#1565c0;text-align:center;margin-bottom:12px}
  .question{padding:12px;border-radius:10px;background:#fbfcff;margin:12px 0;border-right:5px solid #c62828}
  label{display:block;margin:6px 0;cursor:pointer}
  button{display:block;margin:18px auto;padding:10px 18px;background:#1565c0;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:16px}
  .locked{color:#b71c1c;text-align:center;font-weight:bold;padding:20px}
  .note{font-size:13px;color:#555;text-align:center;margin-top:8px}
</style>
</head>
<body>

<div class="card" id="container" aria-live="polite">
  <h1>امتحان أحياء - دخول مرة واحدة</h1>
  <div class="timer">⏱ الوقت المتبقي: <span id="time">24:00</span></div>

  <form id="quizForm">
    <!-- أسئلة (1-15) -->
    <div class="question">
      <p><strong>1.</strong> أي البدائل الآتية لا يُعتبر من مكونات الهيكل العظمي؟</p>
      <label><input type="radio" name="q1" value="a"> لوح الكتف</label>
      <label><input type="radio" name="q1" value="b"> المفصل</label>
      <label><input type="radio" name="q1" value="c"> الأربطة</label>
      <label><input type="radio" name="q1" value="d"> منطقة الحوض</label>
    </div>

    <div class="question">
      <p><strong>2.</strong> النسبة بين طول الضلع رقم (6) إلى طول الضلع رقم (1):</p>
      <label><input type="radio" name="q2" value="a"> أكبر من واحد</label>
      <label><input type="radio" name="q2" value="b"> أقل من واحد</label>
      <label><input type="radio" name="q2" value="c"> يساوي واحد</label>
      <label><input type="radio" name="q2" value="d"> لا يمكن تحديده</label>
    </div>

    <div class="question">
      <p><strong>3.</strong> النسبة بين عدد عظام الحزام الحوضي إلى عظام الحزام الصدري كنسبة:</p>
      <label><input type="radio" name="q3" value="a"> (1 إلى 2)</label>
      <label><input type="radio" name="q3" value="b"> (1 إلى 1)</label>
      <label><input type="radio" name="q3" value="c"> (3 إلى 2)</label>
      <label><input type="radio" name="q3" value="d"> (2 إلى 1)</label>
    </div>

    <div class="question">
      <p><strong>4.</strong> أكبر تجاويف الهيكل الطرفي عمقًا:</p>
      <label><input type="radio" name="q4" value="a"> تجويف الزند</label>
      <label><input type="radio" name="q4" value="b"> التجويف الحُقِّي</label>
      <label><input type="radio" name="q4" value="c"> التجويف الأروح</label>
      <label><input type="radio" name="q4" value="d"> يكون مفصل محدود الحركة</label>
    </div>

    <div class="question">
      <p><strong>5.</strong> تهدف حركة الجذور الشادّة إلى:</p>
      <label><input type="radio" name="q5" value="a"> تأمين ساق النبات والأوراق</label>
      <label><input type="radio" name="q5" value="b"> زيادة طول الجذور الشادّة</label>
      <label><input type="radio" name="q5" value="c"> زيادة القدرة على امتصاص الماء</label>
      <label><input type="radio" name="q5" value="d"> زيادة قدرة النبات على القيام بعملية البناء الضوئي</label>
    </div>

    <div class="question">
      <p><strong>6.</strong> أي المؤثرات التالية تزيد من سرعة تباعد وريقات المستحية؟</p>
      <label><input type="radio" name="q6" value="a"> سقوط الأمطار</label>
      <label><input type="radio" name="q6" value="b"> الظلام</label>
      <label><input type="radio" name="q6" value="c"> الضوء</label>
    </div>

    <div class="question">
      <p><strong>7.</strong> يمكن الاستدلال على حدوث الانسياب السيتوبلازمي بحركة:</p>
      <label><input type="radio" name="q7" value="a"> عضويات تتصف بتعدد ألوانها</label>
      <label><input type="radio" name="q7" value="b"> عضيات عديمة اللون</label>
      <label><input type="radio" name="q7" value="c"> الجدار الخلوي</label>
      <label><input type="radio" name="q7" value="d"> الغشاء الخلوي</label>
    </div>

    <div class="question">
      <p><strong>8.</strong> تتكون العضلات من أنسجة عضلية تعرف بـ:</p>
      <label><input type="radio" name="q8" value="a"> اللحم</label>
      <label><input type="radio" name="q8" value="b"> الخلايا العضلية</label>
      <label><input type="radio" name="q8" value="c"> الليفيات العضلية</label>
      <label><input type="radio" name="q8" value="d"> القطع العضلية</label>
    </div>

    <div class="question">
      <p><strong>9.</strong> الأيونات التي يرتبط معدل مرورها خلال غشاء الليفة العضلية بإثارة العضلة:</p>
      <label><input type="radio" name="q9" value="a"> الصوديوم</label>
      <label><input type="radio" name="q9" value="b"> الكالسيوم والصوديوم</label>
      <label><input type="radio" name="q9" value="c"> الكلور والبروتين</label>
      <label><input type="radio" name="q9" value="d"> الكالسيوم والبوتاسيوم</label>
    </div>

    <div class="question">
      <p><strong>10.</strong> تكون خلايا العضلات التي تقوم بنشاط عنيف نسبة عالية من:</p>
      <label><input type="radio" name="q10" value="a"> حمض اللاكتيك</label>
      <label><input type="radio" name="q10" value="b"> حمض البيروفيك</label>
      <label><input type="radio" name="q10" value="c"> حمض الستريك</label>
      <label><input type="radio" name="q10" value="d"> حمض الأسيتيك</label>
    </div>

    <div class="question">
      <p><strong>11.</strong> من أسباب الإجهاد السريع لعضلة الفخذ:</p>
      <label><input type="radio" name="q11" value="a"> زيادة نسبة الجليكوجين بالعضلة</label>
      <label><input type="radio" name="q11" value="b"> ضيق الشرايين المغذية للعضلة</label>
      <label><input type="radio" name="q11" value="c"> زيادة الأكسجين الوارد للعضلة</label>
      <label><input type="radio" name="q11" value="d"> نقص ثاني أكسيد الكربون بالعضلة</label>
    </div>

    <div class="question">
      <p><strong>12.</strong> النسبة بين حجم عظمة الكيعرة إلى حجم عظمة الزند:</p>
      <label><input type="radio" name="q12" value="a"> تساوي واحد</label>
      <label><input type="radio" name="q12" value="b"> أقل من واحد</label>
      <label><input type="radio" name="q12" value="c"> أكبر من واحد</label>
      <label><input type="radio" name="q12" value="d"> لا يمكن تحديده</label>
    </div>

    <div class="question">
      <p><strong>13.</strong> الحلقة الشوكية هي حلقة عظمية تتصل بالجزء الخاص بـ:</p>
      <label><input type="radio" name="q13" value="a"> الضلع رقم (2)</label>
      <label><input type="radio" name="q13" value="b"> النتوء الشوكي</label>
      <label><input type="radio" name="q13" value="c"> عظمة القص</label>
      <label><input type="radio" name="q13" value="d"> جسم الفقرة القطنية</label>
    </div>

    <div class="question">
      <p><strong>14.</strong> تتغذى الغضاريف عن طريق:</p>
      <label><input type="radio" name="q14" value="a"> أوعية دموية شريانية</label>
      <label><input type="radio" name="q14" value="b"> أوعية دموية وريدية</label>
      <label><input type="radio" name="q14" value="c"> الانتشار من العظام</label>
      <label><input type="radio" name="q14" value="d"> الاسموزية من العظام</label>
    </div>

    <div class="question">
      <p><strong>15.</strong> أصغر وحدة تخزين هي:</p>
      <label><input type="radio" name="q15" value="a"> الأقراص البروتينية</label>
      <label><input type="radio" name="q15" value="b"> الليفة العضلية</label>
      <label><input type="radio" name="q15" value="c"> القطعة العضلية</label>
    </div>

    <button type="button" id="submitBtn">تسليم الامتحان</button>
  </form>

  <div id="lockedMessage" class="locked" style="display:none;">
    ⚠️ هذا الامتحان مغلق — لقد تم التقديم بالفعل من هذا المتصفح.
  </div>

  <p class="note">ملاحظة: إذا حاولت إغلاق الصفحة أو الانتقال منها، سيتم احتساب ذلك كتسليم تلقائي ولن يمكنك إعادة فتح الامتحان من نفس المتصفح.</p>
</div>

<script>
(function(){
  const KEY = "exam_one_time_taken_v1"; // مفتاح التخزين
  const form = document.getElementById("quizForm");
  const locked = document.getElementById("lockedMessage");
  const submitBtn = document.getElementById("submitBtn");
  const timeSpan = document.getElementById("time");
  const TOTAL_SECONDS = 24 * 60; // 24 دقيقة
  let startTimestamp = Date.now();
  let timerInterval = null;

  // لو الامتحان اتسلم قبل كده - امنع الدخول
  if (localStorage.getItem(KEY)) {
    form.style.display = "none";
    locked.style.display = "block";
    // نعرض الوقت اللي اتسلم فيه اختياريًا
    const info = JSON.parse(localStorage.getItem(KEY));
    timeSpan.textContent = "00:00";
    return;
  }

  // مؤقت العد التنازلي
  let remaining = TOTAL_SECONDS;
  function startTimer(){
    timerInterval = setInterval(() => {
      remaining--;
      if (remaining < 0) remaining = 0;
      const m = Math.floor(remaining/60).toString().padStart(2,"0");
      const s = (remaining%60).toString().padStart(2,"0");
      timeSpan.textContent = `${m}:${s}`;
      if (remaining === 0) {
        // وقت المده انتهى -> نعتبر الامتحان "مسلّم"
        finalizeExam("الوقت انتهى");
      }
    }, 1000);
  }
  startTimer();

  // الدالة التي تُسجِّل التسليم (تُستخدم عند الضغط أو عند الخروج)
  function finalizeExam(reason){
    if (localStorage.getItem(KEY)) return; // إذا اتسلم قبل كده لا نعمل حاجة
    // نوقف المؤقت ونخفي الفورم
    clearInterval(timerInterval);
    form.style.display = "none";
    locked.style.display = "block";

    // نحفظ بيانات بسيطة (وقت، سبب) في localStorage لمنع إعادة الفتح
    const payload = {
      takenAt: new Date().toISOString(),
      reason: reason || "submitted"
      // ممكن نضيف إجابات لو تحب تخزنها هنا — حالياً نخزن بس حالة الإغلاق
    };
    try {
      localStorage.setItem(KEY, JSON.stringify(payload));
    } catch(e) {
      // في حالة عدم توافر التخزين (نادر) — لا شيء يمكن فعله من جهة العميل
      console.warn("localStorage error", e);
    }

    // نعرض رسالة قصيرة للطالب
    locked.textContent = "✅ تم تسجيل تسليم الامتحان (" + (payload.reason||"تسليم") + "). شكراً.";
  }

  // عند الضغط على زر التسليم الرسمي
  submitBtn.addEventListener("click", function(){
    if (!confirm("هل أنت متأكد من تسليم الامتحان؟ بعد التسليم لن تتمكن من إعادة الدخول.")) return;
    finalizeExam("تسليم يدوي");
    // هنا ممكن ترسل الإجابات للسيرفر عبر fetch أو sendBeacon لو عندك نقطة استقبال
  });

  // لو المستخدم حاول يغلق الصفحة أو ينتقل -> نعتبرها تسليم
  // نستخدم pagehide وbeforeunload لضمان التغطية في متصفحات مختلفة
  function handlePageHide(e){
    // set flag فورًا
    finalizeExam("الخروج من الصفحة / إغلاق");
    // ملاحظة: إذا أردت إرسال الإجابات إلى سيرفر في الخلفية استخدم navigator.sendBeacon
  }
  window.addEventListener("pagehide", handlePageHide);
  window.addEventListener("beforeunload", handlePageHide);

  // مش لازم، لكن لو حاول المستخدم يفتح الامتحان في تبويب تاني بعد التسليم في نفس المتصفح
  // سيجد أنه مغلق لأن localStorage تم ضبطه.
})();
</script>
</body>
                                                             </html>
